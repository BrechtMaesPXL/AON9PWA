import{_ as O,q as J,i as w,s as A,V as M,r as h,c as f,b as o,t as m,e as l,w as c,f as x,o as _,g as R,h as C,k as L,m as D,l as S,v as B,x as P,p as q,a as z}from"./index-CZpC5zdB.js";import{u as K}from"./foalsStore-DiKilto-.js";import{_ as Q}from"./go-back-arrow-nsKLNE-b.js";let I,v,V,T=[],b=[];function W(t,e){let s;return function(...d){const r=this;clearTimeout(s),s=setTimeout(()=>t.apply(r,d),e)}}const X={name:"DetailHorseView",data(){return{foals:I,name:"",height:"",birthYear:"",isAdmin:!1,selectedLogYear:new Date().getFullYear(),yearsArray:[],newLogYear:new Date().getFullYear()-1,yearAlreadyCreated:!1,showBirthdate:!1,expectedBirthdate:"",isRecording:!1,mediaRecorder:null,recordedChunks:[]}},async setup(){const e=J().currentRoute.value.params.id,s=await w().getHorseById(parseInt(e)),d=s.coverDates,r=await K().getFoalsByMotherId(s.id),n=A(""),g=A(!1);V=new Date().getFullYear(),g.value=s.pregnant,n.value=s.log;try{s.log||(s.log="[]");const u=JSON.parse(s.log),p=Array.isArray(u)?u:[u];v=p.filter(k=>k.year===V)[0],v||(v={year:V,geboortedagboek:""},p.push(v)),T=p.map(k=>k.year),b=p}catch(u){console.error(u)}return I=r,{horseLog:n,gedekt:g,selectedHorse:s,coverDates:d,selectedLog:v}},computed:{getYears(){return T},getLogboek(){return v.geboortedagboek}},mounted(){this.gedekt&&this.calculateExpectedBirthdate()},methods:{goToHomepage(){this.$router.push({name:"home"})},addInputField(){const t=document.querySelector(".div-coverdates"),e=document.createElement("input");e.type="date",e.name="coverDate",e.classList.add("input-field"),e.required=!0,t.appendChild(e),e.addEventListener("change",async s=>{const d=s.target.value,r=new Date(d).getFullYear(),n=new Date(d).getMonth(),g=new Date(d).getDate(),u=this.selectedHorse.id;try{await w().addCoverDateToHorse(u,r,n,g)}catch(p){console.log("Error adding coverDate: ",p)}})},changeYear:async function(t){V=t,v=b.filter(e=>e.year===t)[0],this.selectedLog=v},async changePregnancyValue(){this.gedekt=!this.gedekt;const t=this.selectedHorse.id;try{await w().changePregnancy(t,{pregnant:this.gedekt}),window.location.reload()}catch(e){console.log("Error changing pregnancy: ",e)}this.calculateExpectedBirthdate()},calculateExpectedBirthdate(){let t=new Date("2000-1-1");const e=document.querySelector(".checkbox-gedekt");this.gedekt?(this.coverDates.forEach(s=>{s=new Date(s),s>t&&(t=s)}),t.setDate(t.getDate()+340),e.checked=!0,this.expectedBirthdate=t.toLocaleDateString(),this.showBirthdate=!0):(this.showBirthdate=!1,this.expectedBirthdate="")},async createYear(){if(b.filter(d=>d.year===this.newLogYear).length>0){this.yearAlreadyCreated=!0;return}const e={year:this.newLogYear,geboortedagboek:""};b.push(e);const s={log:JSON.stringify(b)};console.log(s),await w().changeLog(this.selectedHorse.id,s,{headers:{"Content-Type":"application/json"}}),window.location.reload()},changeHorseDetails:W(async function(){const t={log:JSON.stringify(b)};console.log(t),await w().changeLog(this.selectedHorse.id,t,{headers:{"Content-Type":"application/json"}}),window.location.reload()},1e3),GetNextDeworming(t){return t.deworming1?t.deworming2?t.deworming3?t.date4:t.date3:t.date2:t.date1},checkUser(){if(this.user=M.get("userInfo"),this.user!==null)return this.user.role==="ROLE_ADMIN"&&(this.isAdmin=!0),!0;this.$router.push("/login")},goToVeulensDetail(t){this.$router.push({name:"detailFoal",params:{id:t}})},goToAddVuelen(t){this.$router.push({name:"addVeulen",params:{id:t}})},async startRecording(){try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(t),this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.recordedChunks.push({blob:e.data,date:new Date})},this.mediaRecorder.start(),this.isRecording=!0}catch(t){console.error("Error accessing microphone:",t)}},stopRecording(){this.mediaRecorder&&this.isRecording&&(this.mediaRecorder.stop(),this.isRecording=!1,console.log("Recording stopped"))},async replayRecording(t){const e=URL.createObjectURL(t);new Audio(e).play()}}},i=t=>(q("data-v-38f42b55"),t=t(),z(),t),Z={class:"header-content"},$=i(()=>o("div",null,"Geboortejaar",-1)),ee={class:"selectedHorse-data"},te=i(()=>o("div",null,"Stokmaat",-1)),oe={class:"selectedHorse-data"},ae={class:"div-coverdates"},se=i(()=>o("label",{class:"text-dekdata"},"Dekdata",-1)),re=i(()=>o("span",{style:{"font-size":"20px","margin-top":"2px"}},"+",-1)),ne={class:"checkbox-container"},le=["disabled"],de=i(()=>o("label",{for:"checkbox-gedekt"},"Gedekt?",-1)),ce=i(()=>o("div",{class:"div-uitgerekend"},"Uitgerekend",-1)),ie={class:"selectedHorse-data expected-birthdate"},ue={class:"d-flex"},ge=i(()=>o("h1",null,"Voice Recording Demo",-1)),he={class:"logbook"},_e=i(()=>o("br",null,null,-1)),me=i(()=>o("br",null,null,-1)),pe=i(()=>o("hr",null,null,-1)),ve=i(()=>o("br",null,null,-1)),fe={class:"text-center"},ye=i(()=>o("br",null,null,-1)),be={key:1,class:"mb-5 text-center"},ke={class:"w-100"},we={class:"d-flex w-100 mb-3 justify-end"},xe=i(()=>o("span",{class:"mr-4"},"Naam:",-1)),De={class:"data-wrapper"},Ve={class:"d-flex w-100 justify-end"},Re=i(()=>o("span",{class:"mr-4"},"Volgende Ontworming:",-1)),Ce={class:"data-wrapper"},Le=i(()=>o("a",null,"Voeg veulen Toe",-1));function He(t,e,s,d,r,n){const g=h("v-col"),u=h("v-btn"),p=h("v-layout"),k=h("v-select"),F=h("v-text-field"),U=h("v-alert"),E=h("v-textarea"),N=h("v-sheet"),j=h("v-hover"),H=h("v-row"),G=h("v-container");return _(),f(x,null,[o("header",null,[o("div",Z,[o("img",{src:Q,alt:"go back",class:"go-back",onClick:e[0]||(e[0]=(...a)=>n.goToHomepage&&n.goToHomepage(...a))}),o("h1",null,[o("strong",null,m(d.selectedHorse.name),1)])])]),l(G,{class:"container"},{default:c(()=>[l(g,null,{default:c(()=>[$,o("div",ee,m(new Date(d.selectedHorse.birthDate).getFullYear()),1)]),_:1}),l(g,null,{default:c(()=>[te,o("div",oe,m(d.selectedHorse.seize)+" m",1)]),_:1}),l(p,{row:"",wrap:""},{default:c(()=>[l(g,{class:"col-dekdata",style:{"margin-right":"0.5ch"}},{default:c(()=>[o("div",ae,[se,(_(!0),f(x,null,R(d.coverDates,(a,y)=>(_(),f("div",{key:y,class:"existing-coverdates"},m(new Date(a).toLocaleDateString()),1))),128))]),l(u,{class:"addDekdataIcon",onClick:n.addInputField,icon:"mdi-calendar",size:"x-small"},{default:c(()=>[re]),_:1},8,["onClick"])]),_:1}),l(g,{class:"col-gedekt",style:{"margin-left":"0.5ch"}},{default:c(()=>[o("div",ne,[o("input",{type:"checkbox",id:"checkbox-gedekt",class:"checkbox-gedekt",disabled:d.coverDates.length===0,onChange:e[1]||(e[1]=(...a)=>n.changePregnancyValue&&n.changePregnancyValue(...a))},null,40,le),de])]),_:1})]),_:1}),r.showBirthdate?(_(),C(g,{key:0},{default:c(()=>[ce,o("div",ie,m(r.expectedBirthdate),1)]),_:1})):L("",!0),l(g,{class:"col-geboortedagboek d-flex flex-column"},{default:c(()=>[o("div",ue,[l(k,{label:"Jaar",items:n.getYears,variant:"outlined",modelValue:r.selectedLogYear,"onUpdate:modelValue":[e[2]||(e[2]=a=>r.selectedLogYear=a),n.changeYear],"return-object":""},null,8,["items","modelValue","onUpdate:modelValue"]),l(F,{class:"ml-5 mr-5 new-year-input",label:"Ander Jaar",modelValue:r.newLogYear,"onUpdate:modelValue":e[3]||(e[3]=a=>r.newLogYear=a),variant:"outlined"},null,8,["modelValue"]),l(u,{onClick:e[4]||(e[4]=a=>n.createYear(r.newLogYear)),class:"text-h4 bg-success add-year-button"},{default:c(()=>[D("+")]),_:1})]),l(U,{closable:"",text:"Dit jaar is al toegevoegd!",type:"error",class:"mb-5",modelValue:r.yearAlreadyCreated,"onUpdate:modelValue":e[5]||(e[5]=a=>r.yearAlreadyCreated=a)},null,8,["modelValue"]),l(E,{variant:"outlined",label:"Geboortedagboek",class:"geboortedagboek",modelValue:d.selectedLog.geboortedagboek,"onUpdate:modelValue":e[6]||(e[6]=a=>d.selectedLog.geboortedagboek=a),onInput:n.changeHorseDetails,"hide-details":""},null,8,["modelValue","onInput"]),o("div",null,[ge,l(u,{onClick:e[7]||(e[7]=a=>n.startRecording()),disabled:r.isRecording},{default:c(()=>[D("Start Recording")]),_:1},8,["disabled"]),l(u,{onClick:e[8]||(e[8]=a=>n.stopRecording()),disabled:!r.isRecording},{default:c(()=>[D("Stop Recording")]),_:1},8,["disabled"])]),o("div",he,[(_(!0),f(x,null,R(r.recordedChunks,(a,y)=>(_(),f("div",{key:y,class:"logbook-entry"},[o("span",null,m(a.date),1),S(l(u,{onClick:Y=>n.replayRecording(a.blob)},{default:c(()=>[D("Replay")]),_:2},1032,["onClick"]),[[B,a]])]))),128))]),_e]),_:1}),me,pe,ve,o("div",null,[o("h2",fe,"Veulens van "+m(d.selectedHorse.name),1)]),ye,r.foals.length?L("",!0):(_(),f("h4",be,"Geen veulens gevonden.")),(_(!0),f(x,null,R(r.foals,a=>(_(),C(H,{key:a,class:"mt-2 px-3 mb-3"},{default:c(()=>[l(j,null,{default:c(({isHovering:y,props:Y})=>[l(N,P({class:{"on-hover":y},elevation:y?16:2},Y,{class:"w-100",onClick:Ye=>n.goToVeulensDetail(a.id)}),{default:c(()=>[l(g,null,{default:c(()=>[o("div",ke,[o("div",we,[xe,o("div",De,m(a.name),1)]),o("div",Ve,[Re,o("div",Ce,m(new Date(n.GetNextDeworming(a.dewormings)).toLocaleDateString()),1)])])]),_:2},1024)]),_:2},1040,["class","elevation","onClick"])]),_:2},1024)]),_:2},1024))),128)),l(H,{class:"px-3"},{default:c(()=>[n.checkUser()?S((_(),C(u,{key:0,color:"#5f4f36",onClick:e[9]||(e[9]=a=>n.goToAddVuelen(d.selectedHorse.id)),class:"w-100"},{default:c(()=>[Le]),_:1},512)),[[B,r.isAdmin]]):L("",!0)]),_:1})]),_:1})],64)}const Ie=O(X,[["render",He],["__scopeId","data-v-38f42b55"]]);export{Ie as default};
